<?xml version="1.0" encoding="UTF-8"?>
<container xmlns="http://symfony.com/schema/dic/services" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">
  <parameters>
    <parameter key="rednose_framework.doctrine_listener.class">Rednose\FrameworkBundle\EventListener\DoctrineListener</parameter>
    <parameter key="rednose_framework.datetime_formatter.class">Rednose\FrameworkBundle\DateTimeFormatter\DateTimeFormatter</parameter>
    <parameter key="rednose_framework.notification.factory.class">Rednose\FrameworkBundle\Notification\NotificationFactory</parameter>
  </parameters>

  <services>
    <service id="rednose_framework.notification.factory" class="%rednose_framework.notification.factory.class%">
      <argument type="service" id="service_container"/>
    </service>

    <service id="rednose_framework.datetime_formatter" class="%rednose_framework.datetime_formatter.class%">
      <argument type="service" id="service_container"/>
    </service>

    <!-- OAuth 2.0 -->
    <service id="rednose_framework.authorize.form_type" class="Rednose\FrameworkBundle\Form\Type\AuthorizeFormType">
    </service>

    <service id="rednose_framework.authorize.form" factory-method="createNamed" factory-service="form.factory" class="Symfony\Component\Form\Form">
      <argument>rednose_framework_authorize</argument>
      <argument type="service" id="rednose_framework.authorize.form_type" />
    </service>

    <service id="rednose_framework.authorize.form_handler" class="Rednose\FrameworkBundle\Form\Handler\AuthorizeFormHandler" scope="request">
      <argument type="service" id="rednose_framework.authorize.form" />
      <argument type="service" id="request" />
      <argument type="service" id="security.context" />
      <argument type="service" id="fos_oauth_server.server" />
    </service>

    <!-- Override the default FOS OAuth 2.0 client manager for now, eventually we want to configure our own services instead of overriding. -->
    <service id="fos_oauth_server.client_manager.default" class="Rednose\FrameworkBundle\Entity\ClientManager">
      <argument type="service" id="fos_oauth_server.entity_manager" />
      <argument>%fos_oauth_server.model.client.class%</argument>
    </service>

    <!-- JMS Object constructor alias -->
    <service id="rednose_framework.doctrine_object_constructor" class="Rednose\FrameworkBundle\Serializer\Construction\DoctrineObjectConstructor" public="false">
      <argument type="service" id="doctrine"/>
      <argument type="service" id="jms_serializer.unserialize_object_constructor"/>
    </service>
    <service id="jms_serializer.object_constructor" alias="rednose_framework.doctrine_object_constructor" public="false"/>

    <service id="rednose_framework.doctrine_listener" class="%rednose_framework.doctrine_listener.class%">
      <argument type="service" id="event_dispatcher" />
      <tag name="doctrine.event_listener" event="postPersist" />
      <tag name="doctrine.event_listener" event="postUpdate" />
      <tag name="doctrine.event_listener" event="postRemove" />
    </service>

  </services>
</container>
